<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ìƒíƒœ & í™˜ê²½ í€´ì¦ˆ â€” 10ë¬¸í•­</title>
<style>
  :root{
    --bg1: #0f172a;
    --accent1: #72efdd;
    --accent2: #7aa7ff;
    --glass: rgba(255,255,255,0.06);
    --glass-2: rgba(255,255,255,0.04);
    --card-radius: 18px;
    --shadow: 0 10px 30px rgba(2,6,23,0.6);
    --success: #5eead4;
    --danger: #ff7ab6;
    --muted: rgba(255,255,255,0.7);
    font-family: Inter, "Apple SD Gothic Neo", "Noto Sans KR", system-ui, sans-serif;
  }

  html,body{
    height:100%;
    margin:0;
    background: radial-gradient(1200px 500px at 10% 10%, rgba(122,167,255,0.12), transparent),
                radial-gradient(900px 400px at 90% 90%, rgba(114,239,221,0.08), transparent),
                linear-gradient(180deg,#071029 0%, #07183a 50%, #0b1730 100%);
    color: #e6eef8;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Full-bleed container */
  .app {
    min-height:100vh;
    display:grid;
    place-items:center;
    padding:32px;
    box-sizing:border-box;
  }

  .shell {
    width:100%;
    max-width:1100px;
    height: calc(100vh - 64px);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius: calc(var(--card-radius) + 6px);
    box-shadow: var(--shadow);
    padding: 28px;
    box-sizing:border-box;
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:20px;
    overflow:hidden;
  }

  /* Left: quiz area */
  .quiz-area{
    padding: 28px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius: 14px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.03);
    display:flex;
    flex-direction:column;
    gap:18px;
    min-width:0;
  }

  .header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
  }

  .title {
    display:flex;
    gap:12px;
    align-items:center;
  }

  .logo {
    width:56px;
    height:56px;
    border-radius:12px;
    background: linear-gradient(135deg,var(--accent1), var(--accent2));
    display:grid;
    place-items:center;
    font-weight:700;
    color:#021022;
    box-shadow: 0 6px 18px rgba(122,167,255,0.08), inset 0 -6px 18px rgba(0,0,0,0.15);
    font-family: "Segoe UI", Roboto, sans-serif;
  }

  .title h1{
    margin:0;
    font-size:18px;
    letter-spacing:-0.2px;
  }
  .title p{ margin:0; font-size:13px; color:var(--muted); }

  .controls { display:flex; gap:10px; align-items:center; }

  .btn {
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    padding:10px 14px;
    border-radius:12px;
    color:var(--muted);
    font-weight:600;
    cursor:pointer;
    transition: all .18s ease;
    backdrop-filter: blur(6px);
  }
  .btn:hover{ transform: translateY(-3px); box-shadow: 0 10px 26px rgba(2,6,23,0.45); color:#fff; }
  .btn.primary {
    border: none;
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
    color:#021022;
    box-shadow: 0 8px 30px rgba(122,167,255,0.12);
  }

  .progress-wrap {
    width:100%;
    height:14px;
    background: var(--glass-2);
    border-radius: 999px;
    overflow:hidden;
  }
  .progress {
    height:100%;
    width:0%;
    background: linear-gradient(90deg,var(--accent2), var(--accent1));
    transition: width .45s cubic-bezier(.2,.9,.3,1);
  }

  .question-card {
    flex:1;
    display:flex;
    flex-direction:column;
    gap:18px;
    min-height:0;
    justify-content:center;
    align-items:stretch;
  }

  .q-meta { display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .q-number { font-size:13px; color:var(--muted); }
  .q-text { font-size:22px; font-weight:700; line-height:1.18; }

  .options {
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
  }
  .option {
    background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:14px;
    cursor:pointer;
    border:1px solid rgba(255,255,255,0.04);
    transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    display:flex;
    gap:12px;
    align-items:center;
  }
  .option:hover{ transform: translateY(-6px); box-shadow: 0 16px 30px rgba(2,6,23,0.6); }
  .option .letter {
    min-width:36px;
    height:36px;
    border-radius:10px;
    display:grid;
    place-items:center;
    font-weight:800;
    color:#021022;
    background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
    opacity:0.95;
    font-family:monospace;
  }
  .option .text { font-weight:700; color:#e6eef8; }

  .option.disabled{ opacity:0.6; cursor:default; transform:none; box-shadow:none; }
  .option.correct{ border-color: rgba(94,234,212,0.95); box-shadow: 0 8px 24px rgba(94,234,212,0.06); }
  .option.wrong{ border-color: rgba(255,122,182,0.9); box-shadow: 0 8px 24px rgba(255,122,182,0.06); opacity:0.9; }

  .explain {
    padding:12px 14px;
    border-radius:12px;
    background: rgba(0,0,0,0.18);
    color:var(--muted);
    font-size:13px;
  }

  /* Right: sidebar */
  .sidebar {
    padding:22px;
    border-radius: 12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
    display:flex;
    flex-direction:column;
    gap:18px;
    min-width:0;
    align-items:stretch;
  }

  .score {
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
  }
  .score .big {
    font-size:34px;
    font-weight:800;
    letter-spacing:-1px;
    color:var(--accent1);
  }
  .mini {
    font-size:13px;
    color:var(--muted);
  }

  .stat {
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    padding:12px;
    border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border:1px solid rgba(255,255,255,0.03);
  }

  .q-list {
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .q-chip {
    min-width:36px;
    height:36px;
    display:grid;
    place-items:center;
    border-radius:10px;
    font-weight:700;
    background: rgba(255,255,255,0.03);
    color:var(--muted);
    cursor:pointer;
  }
  .q-chip.answered { background: linear-gradient(90deg,var(--accent1),var(--accent2)); color:#021022; }

  .footer {
    display:flex;
    justify-content:space-between;
    gap:10px;
    align-items:center;
    margin-top:auto;
  }

  .small { font-size:12px; color:var(--muted); }

  /* end screen */
  .end-screen {
    position:absolute;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    z-index:40;
  }
  .end-card {
    width:90%;
    max-width:760px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:18px;
    padding:26px;
    box-shadow: var(--shadow);
    text-align:center;
  }
  .end-card h2{ margin:0 0 8px 0; font-size:28px; }
  .end-card p { margin:0 0 18px 0; color:var(--muted); }

  /* confetti (simple) */
  .celebrate {
    position:absolute;
    inset:0;
    pointer-events:none;
    z-index:50;
  }
  .confetti {
    position:absolute;
    width:10px;
    height:14px;
    opacity:0;
    transform-origin:center;
    animation:floatUp 1400ms linear forwards;
  }
  @keyframes floatUp {
    0%{ transform: translateY(0) rotate(0) scale(1); opacity:1; }
    100%{ transform: translateY(-420px) rotate(360deg) scale(.6); opacity:0; }
  }

  /* responsive */
  @media (max-width:980px){
    .shell { grid-template-columns: 1fr; height:auto; padding:18px; gap:14px; }
    .sidebar { order:2; }
  }
  @media (max-width:520px){
    .options { grid-template-columns: 1fr; }
    .logo{ width:48px;height:48px;font-size:14px; }
    .q-text{ font-size:20px; }
    .title h1{ font-size:16px; }
  }
</style>
</head>
<body>
<div class="app">
  <div class="shell" role="application" aria-label="ìƒíƒœ í™˜ê²½ í€´ì¦ˆ ì•±">
    <main class="quiz-area" id="quizArea">
      <div class="header">
        <div class="title">
          <div class="logo">EğŸŒ¿</div>
          <div>
            <h1>ìƒíƒœ & í™˜ê²½ í€´ì¦ˆ</h1>
            <p>10ë¬¸í•­ â€” ì¬ë¯¸ìˆê²Œ í’€ê³  ì§€êµ¬ë¥¼ ë” ì•Œì•„ê°€ìš” ğŸŒ</p>
          </div>
        </div>

        <div class="controls">
          <div class="small">ë‚¨ì€ì‹œê°„</div>
          <div id="timer" class="btn" style="min-width:72px;">--:--</div>
          <button class="btn" id="restartBtn" title="ì²˜ìŒë¶€í„°">ë‹¤ì‹œí•˜ê¸°</button>
        </div>
      </div>

      <div class="progress-wrap" aria-hidden="true">
        <div id="prog" class="progress" style="width:0%"></div>
      </div>

      <section class="question-card" id="questionCard" aria-live="polite">
        <!-- question content injected by JS -->
      </section>

      <div class="footer">
        <div class="small">í‚¤ë³´ë“œ: ìˆ«ìí‚¤(1-4)ë¡œ ì„ íƒ, â† â†’ë¡œ ì´ë™</div>
        <div>
          <button class="btn" id="prevBtn" aria-label="ì´ì „ ë¬¸ì œ">ì´ì „</button>
          <button class="btn primary" id="nextBtn" aria-label="ë‹¤ìŒ ë¬¸ì œ">ë‹¤ìŒ</button>
        </div>
      </div>
    </main>

    <aside class="sidebar" aria-label="ì§„í–‰ ì •ë³´">
      <div class="score">
        <div>
          <div class="mini">ì ìˆ˜</div>
          <div class="big" id="score">0</div>
        </div>
        <div style="text-align:right">
          <div class="mini">ì •ë‹µë¥ </div>
          <div class="big" id="pct">0%</div>
        </div>
      </div>

      <div class="stat">
        <div>
          <div class="mini">ë¬¸ì œ</div>
          <div style="font-weight:800">ì´ 10ë¬¸í•­</div>
        </div>
        <div>
          <div class="mini">í˜„ì¬</div>
          <div id="currentIdx" style="font-weight:800">1 / 10</div>
        </div>
      </div>

      <div>
        <div class="mini" style="margin-bottom:8px">ë¬¸ì œ ëª©ë¡</div>
        <div class="q-list" id="qList" role="tablist" aria-label="ë¬¸ì œ ëª©ë¡">
          <!-- chips -->
        </div>
      </div>

      <div style="margin-top:auto;">
        <div class="mini">í€´ì¦ˆì„ ë§ˆì¹˜ë©´ ì„¤ëª…(í•´ì„¤)ì´ ì œê³µë©ë‹ˆë‹¤.</div>
      </div>
    </aside>

    <!-- end overlay -->
    <div class="end-screen" id="endScreen" role="dialog" aria-modal="true">
      <div class="end-card" id="endCard">
        <h2 id="endTitle">ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
        <p id="endText">í€´ì¦ˆë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
        <div style="display:flex;gap:10px;justify-content:center;margin-top:16px;">
          <button class="btn" id="reviewBtn">ì •ë‹µ í™•ì¸</button>
          <button class="btn primary" id="retakeBtn">ë‹¤ì‹œ í’€ê¸°</button>
        </div>
      </div>
    </div>

    <!-- confetti container -->
    <div class="celebrate" id="celebrate"></div>
  </div>
</div>

<script>
/* Quiz data â€” 10 questions about ecology & environment (Korean) */
const QUIZ = [
  {
    q: "ì§€êµ¬ ì˜¨ë‚œí™”ì˜ ì›ì¸ì´ë©´ì„œ ì˜¨ì‹¤íš¨ê³¼ë¥¼ ì¼ìœ¼í‚¤ëŠ” ì£¼ëœ ê¸°ì²´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
    opts: ["ì‚°ì†Œ (Oâ‚‚)", "ì´ì‚°í™”íƒ„ì†Œ (COâ‚‚)", "ì§ˆì†Œ (Nâ‚‚)", "ì•„ë¥´ê³¤ (Ar)"],
    a: 1,
    explain: "ì´ì‚°í™”íƒ„ì†Œ(COâ‚‚)ëŠ” í™”ì„ì—°ë£Œ ì—°ì†Œ ë“±ìœ¼ë¡œ ëŒ€ê¸° ì¤‘ ë†ë„ê°€ ì¦ê°€í•˜ì—¬ ì˜¨ì‹¤íš¨ê³¼ë¥¼ ê°•í™”í•©ë‹ˆë‹¤."
  },
  {
    q: "ë°”ë‹·ë¬¼ì˜ ê³¼ë„í•œ ì˜ì–‘ì—¼ë¥˜(ì§ˆì†ŒÂ·ì¸) ìœ ì…ìœ¼ë¡œ ì¸í•´ ì¼ì–´ë‚˜ëŠ” í˜„ìƒì€?",
    opts: ["ì‚¬ë§‰í™”", "ë¶€ì˜ì–‘í™” (Eutrophication)", "ë¹™í•˜í˜•ì„±", "ì‚°ì‚¬íƒœ"],
    a: 1,
    explain: "ì˜ì–‘ì—¼ë¥˜ê°€ ëŠ˜ë©´ í”Œë‘í¬í†¤ ëŒ€ì¦ì‹ â†’ ì‚°ì†Œ ê³ ê°ˆ â†’ ì–´íŒ¨ë¥˜ í”¼í•´ ë“±ì´ ì¼ì–´ë‚©ë‹ˆë‹¤."
  },
  {
    q: "ìƒë¬¼ë‹¤ì–‘ì„±(biodiversity)ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ìš”ì†ŒëŠ” ë¬´ì—‡ì¼ê¹Œìš”?",
    opts: ["ìœ ì „ì  ë‹¤ì–‘ì„±", "ìƒíƒœê³„ ë‹¤ì–‘ì„±", "ë¬¸í™”ì  ë‹¤ì–‘ì„±", "ì¢…(ì¢…ë¥˜) ë‹¤ì–‘ì„±"],
    a: 2,
    explain: "ìƒë¬¼ë‹¤ì–‘ì„±ì€ ìœ ì „ì  ë‹¤ì–‘ì„±, ì¢… ë‹¤ì–‘ì„±, ìƒíƒœê³„ ë‹¤ì–‘ì„± ë“±ì„ ë§í•©ë‹ˆë‹¤. ë¬¸í™”ì  ë‹¤ì–‘ì„±ì€ í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
  },
  {
    q: "ë‹¤ìŒ ì¤‘ íƒ„ì†Œ í¡ìˆ˜ì›(carbon sink)ì— í•´ë‹¹í•˜ëŠ” ê²ƒì€?",
    opts: ["ì‚°ì—… ê³µì¥", "ì‚¼ë¦¼(ìˆ²)", "ìë™ì°¨", "í™”ë ¥ë°œì „ì†Œ"],
    a: 1,
    explain: "ë‚˜ë¬´ì™€ í† ì–‘ì€ ëŒ€ê¸° ì¤‘ COâ‚‚ë¥¼ í¡ìˆ˜í•´ ì €ì¥í•˜ë¯€ë¡œ ì¤‘ìš”í•œ íƒ„ì†Œ í¡ìˆ˜ì›ì…ë‹ˆë‹¤."
  },
  {
    q: "ì¬ì‚¬ìš©(reuse), ê°ëŸ‰(reduce), ì¬í™œìš©(recycle)ì˜ '3R' ì›ì¹™ì—ì„œ 'ê°ëŸ‰'ì´ ì˜ë¯¸í•˜ëŠ” ê²ƒì€?",
    opts: ["ì“°ë ˆê¸°ë¥¼ ë” ë§ì´ ë§Œë“¤ê¸°", "ë¬¼ê±´ì˜ êµ¬ë§¤Â·ì‚¬ìš©ì„ ì¤„ì—¬ íê¸°ë¬¼ì„ ì¤„ì´ê¸°", "ëª¨ë“  ê²ƒì„ ì¬í™œìš© ì²˜ë¦¬í•˜ê¸°", "ì“°ë ˆê¸°ë¥¼ ì†Œê°í•˜ê¸°"],
    a: 1,
    explain: "'ê°ëŸ‰'ì€ ì œí’ˆ ì‚¬ìš©Â·êµ¬ì… ìì²´ë¥¼ ì¤„ì—¬ ì“°ë ˆê¸°ë¥¼ ì²˜ìŒë¶€í„° ì¤„ì´ëŠ” ê²ƒì„ ëœ»í•©ë‹ˆë‹¤."
  },
  {
    q: "ì™¸ë˜ ì¢…(invasive species)ì´ í† ì°© ìƒíƒœê³„ì— ì£¼ë¡œ ë¯¸ì¹˜ëŠ” ì˜í–¥ì€?",
    opts: ["ì„œë¡œ ê³µì¡´í•˜ë©° ìƒë¬¼ë‹¤ì–‘ì„± ì¦ê°€", "í† ì°©ì¢…ì„ ë°€ì–´ë‚´ì–´ ìƒíƒœê³„ êµë€", "í† ì–‘ ë¹„ì˜¥ë„ë¥¼ ë¬´ì¡°ê±´ ë†’ì„", "ê¸°í›„ë¥¼ ì•ˆì •í™”í•¨"],
    a: 1,
    explain: "ì™¸ë˜ì¢…ì€ ê²½ìŸÂ·í¬ì‹ ë“±ì„ í†µí•´ í† ì°©ì¢…ì„ ìœ„í˜‘í•˜ê³  ìƒíƒœê³„ë¥¼ ë¶ˆê· í˜•í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤."
  },
  {
    q: "í•´ì–‘ í”Œë¼ìŠ¤í‹± ì“°ë ˆê¸°ê°€ ë¯¸ì¹˜ëŠ” ëŒ€í‘œì  ë¬¸ì œë¡œ ì˜³ì§€ ì•Šì€ ê²ƒì€?",
    opts: ["í•´ì–‘ìƒë¬¼ì˜ ì„­ì‹ê³¼ ì§ˆì‹", "ë¯¸ì„¸í”Œë¼ìŠ¤í‹±ì„ í†µí•œ ì‹í’ˆê³„ì˜ ì˜¤ì—¼", "ë°”ë‹·ë¬¼ì˜ ì—¼ë„ ê¸‰ê²© ì¦ê°€", "ì„œì‹ì§€ íŒŒê´´"],
    a: 2,
    explain: "í”Œë¼ìŠ¤í‹±ì€ ì„œì‹ì§€ íŒŒê´´Â·ì„­ì‹Â·ë¯¸ì„¸í”Œë¼ìŠ¤í‹± ì˜¤ì—¼ì„ ìœ ë°œí•˜ì§€ë§Œ, ë°”ë‹·ë¬¼ ì—¼ë„ê°€ ê¸‰ê²©íˆ ì¦ê°€ì‹œí‚¤ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤."
  },
  {
    q: "ìƒíƒœê³„ì—ì„œ ìƒì‚°ì(producer)ì— í•´ë‹¹í•˜ëŠ” ê²ƒì€?",
    opts: ["ì´ˆì‹ë™ë¬¼", "ìœ¡ì‹ë™ë¬¼", "ì‹ë¬¼(ê´‘í•©ì„±ì„ í•˜ëŠ” ìƒë¬¼)", "ë¶„í•´ì(ë¯¸ìƒë¬¼)"],
    a: 2,
    explain: "ìƒì‚°ìëŠ” íƒœì–‘ì—ë„ˆì§€ë¥¼ ì´ìš©í•´ ìœ ê¸°ë¬¼ì„ ë§Œë“œëŠ” ìƒë¬¼(ì˜ˆ: ì‹ë¬¼)ì…ë‹ˆë‹¤."
  },
  {
    q: "ì»´í¬ìŠ¤íŠ¸(í‡´ë¹„)ë¥¼ ë§Œë“¤ ë•Œ í¬ê²Œ ì¤‘ìš”í•˜ì§€ ì•Šì€ ìš”ì†ŒëŠ” ë¬´ì—‡ì¼ê¹Œìš”?",
    opts: ["ì ì ˆí•œ ìˆ˜ë¶„", "íƒ„ì†Œì™€ ì§ˆì†Œì˜ ë¹„ìœ¨", "ì‚°ì†Œ ê³µê¸‰(í†µê¸°)", "ì „ê¸° ê³µê¸‰"],
    a: 3,
    explain: "í‡´ë¹„í™”ëŠ” ìœ ê¸°ë¬¼ ë¶„í•´ê³¼ì •ìœ¼ë¡œ ì „ê¸° ê³µê¸‰ì´ í•„ìš”í•˜ì§€ ì•Šìœ¼ë©°, ìˆ˜ë¶„Â·C/Në¹„Â·í†µê¸°ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤."
  },
  {
    q: "ì¬ìƒê°€ëŠ¥ì—ë„ˆì§€(renewable energy)ì— í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ê²ƒì€?",
    opts: ["íƒœì–‘ê´‘ ì—ë„ˆì§€", "í’ë ¥ ì—ë„ˆì§€", "ì„íƒ„", "ì§€ì—´ ì—ë„ˆì§€"],
    a: 2,
    explain: "ì„íƒ„ì€ í™”ì„ì—°ë£Œë¡œ ì¬ìƒ ë¶ˆê°€ëŠ¥í•œ ì—ë„ˆì§€ì…ë‹ˆë‹¤."
  }
];

/* state */
let state = {
  idx: 0,
  answers: Array(QUIZ.length).fill(null),
  score: 0,
  timeLeft: 8 * 60 // total quiz time seconds (optional) â€” 8 minutes
};

/* DOM refs */
const questionCard = document.getElementById('questionCard');
const prog = document.getElementById('prog');
const scoreEl = document.getElementById('score');
const pctEl = document.getElementById('pct');
const currIdxEl = document.getElementById('currentIdx');
const qList = document.getElementById('qList');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const restartBtn = document.getElementById('restartBtn');
const endScreen = document.getElementById('endScreen');
const endTitle = document.getElementById('endTitle');
const endText = document.getElementById('endText');
const reviewBtn = document.getElementById('reviewBtn');
const retakeBtn = document.getElementById('retakeBtn');
const celebrate = document.getElementById('celebrate');
const timerEl = document.getElementById('timer');

/* helpers */
function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }
function formatTime(sec){
  const m = Math.floor(sec/60).toString().padStart(2,'0');
  const s = (sec%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

/* initialize question chips */
function initQChips(){
  qList.innerHTML = '';
  QUIZ.forEach((q,i)=>{
    const chip = document.createElement('button');
    chip.className = 'q-chip';
    chip.textContent = i+1;
    chip.setAttribute('aria-label', `ë¬¸ì œ ${i+1}ë¡œ ì´ë™`);
    chip.addEventListener('click', ()=> {
      goTo(i);
    });
    qList.appendChild(chip);
  });
}

/* render UI for current question */
function render(){
  const i = state.idx;
  const data = QUIZ[i];
  // progress
  const percent = Math.round((i/(QUIZ.length))*100);
  prog.style.width = `${(i+1)/QUIZ.length*100}%`;
  currIdxEl.textContent = `${i+1} / ${QUIZ.length}`;

  // score
  scoreEl.textContent = state.score;
  const pct = Math.round((state.score / QUIZ.length) * 100);
  pctEl.textContent = pct + '%';

  // chips answered
  Array.from(qList.children).forEach((chip, idx)=>{
    chip.classList.toggle('answered', state.answers[idx] !== null);
  });

  // build question area
  questionCard.innerHTML = '';
  const meta = document.createElement('div');
  meta.className = 'q-meta';
  meta.innerHTML = `<div class="q-number">ë¬¸ì œ ${i+1}</div><div class="q-number small">ë‚œì´ë„: ì‰¬ì›€</div>`;
  const qtext = document.createElement('div');
  qtext.className = 'q-text';
  qtext.textContent = data.q;

  const optsWrap = document.createElement('div');
  optsWrap.className = 'options';

  data.opts.forEach((opt, oi)=>{
    const btn = document.createElement('button');
    btn.className = 'option';
    btn.setAttribute('data-choice', oi);
    btn.setAttribute('aria-pressed', 'false');
    btn.innerHTML = `<div class="letter">${String.fromCharCode(65+oi)}</div><div class="text">${opt}</div>`;
    // keyboard focusable
    btn.addEventListener('click', ()=> selectOption(i, oi));
    // mark chosen
    if(state.answers[i] !== null){
      btn.classList.add('disabled');
      if(state.answers[i] === data.a && oi === data.a) btn.classList.add('correct');
      if(state.answers[i] !== data.a && oi === state.answers[i]) btn.classList.add('wrong');
      if(state.answers[i] !== data.a && oi === data.a) btn.classList.add('correct');
    }
    optsWrap.appendChild(btn);
  });

  questionCard.appendChild(meta);
  questionCard.appendChild(qtext);
  questionCard.appendChild(optsWrap);

  // explanation if already answered
  if(state.answers[i] !== null){
    const expl = document.createElement('div');
    expl.className = 'explain';
    const right = QUIZ[i].a;
    const isRight = state.answers[i] === right;
    expl.innerHTML = `<strong>ì •ë‹µ: ${String.fromCharCode(65+right)}. ${QUIZ[i].opts[right]}</strong><div style="margin-top:8px;color:var(--muted)">${QUIZ[i].explain}</div>`;
    questionCard.appendChild(expl);
  }

  // prev/next button states
  prevBtn.disabled = i === 0;
  nextBtn.disabled = i === QUIZ.length - 1;

  // Accessibility focus
  questionCard.querySelector('.q-text')?.focus?.();

  // update timer element immediately
  timerEl.textContent = formatTime(state.timeLeft);
}

/* select an option */
function selectOption(qIndex, choice){
  if(state.answers[qIndex] !== null) return;
  state.answers[qIndex] = choice;
  const correct = QUIZ[qIndex].a;
  if(choice === correct){
    state.score += 1;
    // small celebration for correct
    spawnConfetti(8);
  } else {
    // slight pulse for wrong (optional)
    flashWrong();
  }
  // auto re-render
  render();
  // if finished all questions -> show end
  if(state.answers.every(a=>a!==null)){
    setTimeout(showEndScreen, 700);
  }
}

/* navigation */
function goTo(i){
  state.idx = clamp(i, 0, QUIZ.length-1);
  render();
}

prevBtn.addEventListener('click', ()=> {
  if(state.idx>0) { state.idx--; render(); }
});
nextBtn.addEventListener('click', ()=> {
  if(state.idx<QUIZ.length-1){ state.idx++; render(); }
});
restartBtn.addEventListener('click', ()=> {
  if(confirm('í€´ì¦ˆë¥¼ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í• ê¹Œìš”? í˜„ì¬ ì§„í–‰ì€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.')) resetAll();
});
retakeBtn.addEventListener('click', ()=> {
  resetAll();
  endScreen.style.display = 'none';
});
reviewBtn.addEventListener('click', ()=> {
  endScreen.style.display = 'none';
  // jump to first incorrect or start
  const firstWrong = state.answers.findIndex((ans, idx) => ans !== QUIZ[idx].a);
  goTo(firstWrong >= 0 ? firstWrong : 0);
});

/* timer */
let timerInterval = null;
function startTimer(){
  clearInterval(timerInterval);
  updateTimerUI();
  timerInterval = setInterval(()=>{
    state.timeLeft = Math.max(0, state.timeLeft - 1);
    updateTimerUI();
    if(state.timeLeft <= 0){
      clearInterval(timerInterval);
      // auto finish: mark unanswered as wrong (null stays null but end quiz)
      showEndScreen(true);
    }
  }, 1000);
}
function updateTimerUI(){
  timerEl.textContent = formatTime(state.timeLeft);
  // color change when low
  if(state.timeLeft <= 60) timerEl.style.borderColor = 'rgba(255,122,182,0.9)';
  else timerEl.style.borderColor = 'transparent';
}

/* end screen */
function showEndScreen(timedOut = false){
  // stop timer
  clearInterval(timerInterval);
  endScreen.style.display = 'grid';
  const correctCount = state.score;
  endTitle.textContent = timedOut ? 'ì‹œê°„ ì¢…ë£Œ!' : 'í€´ì¦ˆ ì™„ë£Œ!';
  endText.innerHTML = `ì •ë‹µ <strong>${correctCount}</strong> / ${QUIZ.length} â€” ${Math.round(correctCount / QUIZ.length * 100)}%`;
  if(correctCount === QUIZ.length){
    spawnConfetti(40);
  }
